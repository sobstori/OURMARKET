@model IEnumerable<OurMarketBackend.Models.Listing>

@{
    ViewData["Title"] = "Browse Listings";
    var q = (string)Context.Request.Query["q"];
    var category = (string)Context.Request.Query["category"];
    var location = (string)Context.Request.Query["location"];
}

<h1>Browse Listings</h1>

<form method="get" class="filters">
    <input type="text" name="q" value="@Context.Request.Query["q"]" placeholder="Search listings..." />

    <select name="category">
        <option value="">All Categories</option>
        <option value="Electronics" selected="@(category == "Electronics")">Electronics</option>
        <option value="Furniture" selected="@(category == "Furniture")">Furniture</option>
        <option value="Clothing" selected="@(category == "Clothing")">Clothing</option>
        <option value="Jobs" selected="@(category == "Jobs")">Jobs</option>
    </select>

    <input type="text" name="location" value="@location"
           placeholder="City or State (e.g., TX)" />

    <button type="submit">Apply Filter</button>
</form>

<section class="listings-grid">
    @foreach (var listing in Model)
    {
        var imgPath = listing.Images?.FirstOrDefault()?.FileName != null
        ? Url.Content($"~/images/listings/{listing.Images.First().FileName}")
        : Url.Content("~/img/placeholder.png");

        string city = listing.Location?.Split(',')[0] ?? "";
        string state = listing.Location?.Split(',').Length > 1
        ? listing.Location.Split(',')[1].Trim()
        : "";

        <a class="listing-card"
           asp-controller="Listings"
           asp-action="Details"
           asp-route-id="@listing.Id">
            <img src="@imgPath" alt="@listing.Title" />
            <h2>@listing.Title</h2>
            <p>@listing.Price Â· @city @state</p>
        </a>
    }
</section>
